---
apiVersion: kuttl.dev/v1beta1
kind: TestAssert
timeout: 300
commands:
  - script: kubectl exec -n $NAMESPACE trino-test-helper -- python /tmp/check-active-workers.py -u admin -p "" -c trino-coordinator -w 2
  - script: kubectl exec -n $NAMESPACE deployment/minio -- mc alias set local https://localhost:9000 minioAccessKey minioSecretKey --api S3v4
  # Verify that the spooling bucket contains data
  - script: |
      count=$(kubectl exec -n $NAMESPACE deployment/minio -- mc ls --insecure local/spooling-bucket/trino | wc -l)
      echo "Number of spool segments is [$count] (should be > 0)"
      if [ "$count" -eq 0 ]; then
        exit 1
      fi
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: trino-coordinator-default
status:
  readyReplicas: 1
  replicas: 1
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: trino-worker-default
status:
  readyReplicas: 2
  replicas: 2
